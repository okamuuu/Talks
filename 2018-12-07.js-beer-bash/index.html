<!DOCTYPE html>
<html>
  <head>
    <title>第５回 JS ビアバッシュ 初心者勉強会 in西新宿</title>
    <meta charset="utf-8">
    <style>
      @import url(https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);
      @import url(https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic);
      @import url(https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic);

      body { font-family: 'Droid Serif'; color: hsl(0, 0%, 4%) }
      h1, h2, h3 {
        font-size: 48px;
        font-family: 'Yanone Kaffeesatz';
        font-weight: normal;
      }
      p, ol, ul {
        font-size: 32px;
      }
      .remark-code, .remark-inline-code { 
        font-size: 26px;
        font-family: 'Ubuntu Mono'; 
      }
      .red { color: hsl(348, 100%, 61%) }
    </style>
  </head>
  <body>
    <textarea id="source">

class: center, middle

# nuxt-client-init-module

第５回JS ビアバッシュ 初心者勉強会 in西新宿<br />
2018-12-08<br />
okamuuu

---

class: center, middle

# こんにちは

---

# 最近 Nuxt.js を使っています

お客様が SSR したいっぽいので後から言われても困らないように Nuxt.js を選定しました。

---

# Nuxt.js で SSR して気づいたこと

画面を reload すると、レンダリング直後にJS側(仮想DOM)がもう一度 rendering している

何故直後に re-rendering しているのか？

最初はピンとこなかった

---

# ある日問題発生

CSS の適用が遅れて画面のデザインが一瞬崩れる

デザインが崩れるのは一瞬だけなので fade in させよう

---

# 以下のようなコードを書いた

```javascript
async nuxtServerInit (store, context) {
  setTimeout(function() {
    store.state.isLoading = false
  }, 500)
}
```

isLoading が true になったら画面を表示させようとした

---

# いつまでたっても画面は真っ白だった

```javascript
async nuxtServerInit (store, context) {
  setTimeout(function() {
    store.state.isLoading = false
  }, 500)
}
```

nuxtServerInit は実行直後の state を元に HTML を書き出しているのでその後に setTimeout で state 変えても意味がない

---

# client 側で最初に一度だけ呼ばれる関数が欲しい

nuxt-client-init-module を使えば良い感じにできました

```javascript
async nuxtServerInit (store, context) {
  ...
},
async nuxtClientInit (store, context) {
  setTimeout(function() {
    store.state.isLoading = false
  }, 500)
}
```

---

# まとめ

* SSR したあともう一度 SPA している理由はよく分からなかった。
* nuxtServerInit では state の変化に対応できないことが分かった。
* nuxtClientInit 的な関数が欲しくなった。
* そんなときは nuxt-client-init-module を使いましょう

---

class: center, middle

# おしまい

    </textarea>
    <script src="https://remarkjs.com/downloads/remark-latest.min.js">
    </script>
    <script>
      var slideshow = remark.create();
    </script>
  </body>
</html>
